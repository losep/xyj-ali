//六道轮回   Edit bye beeby
// TFXYJ 7/7/2000

#include <ansi.h>

inherit SSERVER;

int perform(object me, object target)
{
        string msg,ws;
        int damage, ap, dp, tt;
        int number, size, i, four,amount;

	if (!me->is_fighting())
		return notify_fail("「六道轮回」只能在战斗中使用!\n");

        if( !target ) target = offensive_target(me);

        if( !target
        ||      !target->is_character()
        ||      target->is_corpse()
        ||      target==me)
                return notify_fail("你要对谁施展「六道轮回」？\n");

        if((int)me->query("force") < 25+(int)me->query("force_factor") )
                return notify_fail("你的内力不够！\n");
        if((int)me->query("kee") < 100 )
                return notify_fail("你的气血不足，没法子施用外功！\n");

        if((int)me->query_skill("hellfire-whip", 1) <80)
                return notify_fail("你的烈火鞭级别还不够！\n");

        me->add("force", -25-(int)me->query("force_factor"));
        me->receive_damage("kee", 100);
	ws=(string)(me->query_temp("weapon"))->query("name");
        msg = BLU
"\n$N阴恻恻地一笑，手中"+ws+"突然慢了下来，"+
"$n一见大喜，抓住机会，上前就是一轮疾攻！\n" NOR;
	message_vision(msg,me,target);
	tt=3+random(2);
	me->start_busy(tt);
	call_out("do_attack",tt,me,target);
	return 1;
}

int do_attack(object me,object target)
{
	string msg,ws;
	int myattack,mydamage;
	ws=(string)me->query_temp("weapon")->query("name");
	msg=HIR"$N鞭势突然一变，手中"+
		ws+"幻做漫天鞭影，将$n的退路全部封死。\n"+
		"$n觉得有如置身炼狱，四周都是熊熊鬼火，深受轮回之苦，连气都透不过来。\n"NOR;
	message_vision(msg,me,target);
/*	if (!myattack=(int)me->query_temp("apply/attack"))
	   myattack = 0;
	if (!mydamage=(int)me->query_temp("apply/damage"))
	   mydamage = 0;
//	myattack=(int)me->query_temp("apply/attack");
//	mydamage=(int)me->query_temp("apply/damage");
	me->add_temp("apply/attack",me->query_skill("hellfire-whip",1)/2);
	me->add_temp("apply/damage",me->query_skill("hellfire-whip",1)/4);
*/
	me->set_temp("HellZhen",1);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
	me->set_temp("HellZhen",2);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
	me->set_temp("HellZhen",3);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
	me->set_temp("HellZhen",4);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
	me->set_temp("HellZhen",5);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
	me->set_temp("HellZhen",6);
	COMBAT_D->do_attack(me, target, me->query_temp("weapon"));
//	me->set_temp("apply/attack",myattack);
//	me->set_temp("apply/damage",mydamage);
        if( !target->is_fighting(me) ) {
                if( living(target) ) {
                        if( userp(target) ) target->fight_ob(me);
                        else target->kill_ob(me);
                }
        }
        
        return 1;
}
